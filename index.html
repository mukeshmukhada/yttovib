<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audio to Vibration</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f9f9f9; }
    h1 { font-size: 1.5rem; }
    input { margin-top: 1rem; }
    button { margin-top: 1rem; padding: 0.5rem 1rem; }
  </style>
</head>
<body>
  <h1>Convert Audio to Vibration</h1>
  <input type="file" id="audioFile" accept="audio/*"><br>
  <button id="processBtn">Convert & Vibrate</button>

  <script>
    const fileInput = document.getElementById('audioFile');
    const button = document.getElementById('processBtn');

    button.onclick = async () => {
      if (!fileInput.files[0]) {
        alert('Please select an audio file.');
        return;
      }

      const file = fileInput.files[0];
      const arrayBuffer = await file.arrayBuffer();
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
      const data = audioBuffer.getChannelData(0); // mono for simplicity

      const chunkSize = 1024; // ~23ms at 44.1kHz
      const pattern = [];

      for (let i = 0; i < data.length; i += chunkSize) {
        let sum = 0;
        for (let j = 0; j < chunkSize && i + j < data.length; j++) {
          sum += Math.abs(data[i + j]);
        }
        const avg = sum / chunkSize;

        // Map avg volume to vibration or pause duration
        if (avg > 0.1) {
          pattern.push(50); // vibrate 50ms
        } else {
          pattern.push(0);  // no vibration
        }
        pattern.push(50);   // always pause 50ms
      }

      // Limit pattern length for browser limits
      const limitedPattern = pattern.slice(0, 300); // ~15s

      if ('vibrate' in navigator) {
        const success = navigator.vibrate(limitedPattern);
        if (!success) {
          alert("Vibration failed (maybe browser doesn't support it).");
        }
      } else {
        alert("Vibration API not supported on this device.");
      }
    };
  </script>
</body>
</html>
